version: '{build}'
branches:
  only:
  - master
image:
    - Visual Studio 2017
clone_folder: c:\projects\simdjson

platform:
- x64

environment:
  matrix:
    - SIMDJSON_BUILD_STATIC: "OFF"
      THREADS: "ON"
    - SIMDJSON_BUILD_STATIC: "OFF"
      THREADS: "OFF"
    - SIMDJSON_BUILD_STATIC: "ON"
      THREADS: "ON"
#    - SIMDJSON_BUILD_STATIC: "ON"
#      THREADS: "OFF"
      
build_script:
  - mkdir build
  - cd build
  - ps: cmake -DSIMDJSON_BUILD_STATIC="$env:SIMDJSON_BUILD_STATIC" -DSIMDJSON_ENABLE_THREADS="$env:THREADS" -DCMAKE_BUILD_TYPE=Release -DCMAKE_GENERATOR_PLATFORM=x64 -DSIMDJSON_GOOGLE_BENCHMARKS=OFF ..
  - cmake --build .
  - ctest --verbose --output-on-failure

